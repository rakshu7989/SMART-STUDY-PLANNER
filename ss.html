<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Study Planner</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#7c3aed; --accent-2:#06b6d4;
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
      color-scheme: dark;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071028 0%, #071022 50%);color:#e6eef8}
    .app{max-width:1200px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:20px;letter-spacing:0.3px}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);border:0;padding:8px 12px;border-radius:10px;color:white;cursor:pointer;box-shadow:0 6px 18px rgba(124,58,237,0.14)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}

    .layout{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}
    .sidebar{background:linear-gradient(180deg,var(--glass),var(--glass-2));padding:14px;border-radius:14px}
    .card{background:linear-gradient(180deg,#071427 0%, #08102a 100%);padding:14px;border-radius:12px}

    .section{margin-bottom:14px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=date], input[type=time], select, textarea{width:100%;padding:8px;border-radius:8px;background:#07172b;border:1px solid rgba(255,255,255,0.03);color:#e6eef8}
    textarea{min-height:64px}

    .quick-stats{display:flex;gap:10px}
    .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:10px;flex:1}
    .muted{color:var(--muted);font-size:13px}

    /* timeline / board */
    .board{display:flex;gap:12px;align-items:flex-start}
    .day{min-width:160px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:10px;border-radius:10px}
    .day h3{margin:0 0 8px 0;font-size:14px}
    .task{background:linear-gradient(90deg,var(--card),#071829);padding:10px;border-radius:10px;margin-bottom:8px;cursor:grab;border-left:6px solid var(--accent);box-shadow:0 6px 18px rgba(0,0,0,0.35)}
    .task.low{border-left-color:#34d399}
    .task.medium{border-left-color:#f59e0b}
    .task.high{border-left-color:#ef4444}
    .task .title{font-weight:600}
    .task .meta{font-size:12px;color:var(--muted);margin-top:6px;display:flex;justify-content:space-between}

    .timeline-wrap{overflow:auto;padding:10px;background:transparent;border-radius:10px}

    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(2,6,23,0.6),transparent);backdrop-filter:blur(4px);z-index:60}
    .modal.open{display:flex}
    .modal-card{width:760px;background:linear-gradient(180deg,#061224 0%, #071426 100%);padding:18px;border-radius:12px;box-shadow:0 10px 40px rgba(2,6,23,0.8)}
    .row{display:flex;gap:10px}
    .col{flex:1}
    .label-inline{font-size:12px;color:var(--muted);margin-bottom:6px}

    .small{font-size:13px}
    footer{margin-top:18px;color:var(--muted);font-size:13px}

    /* stats canvas */
    #stats{width:100%;height:120px;border-radius:8px;background:linear-gradient(180deg,#081426,#061426);display:block}

    /* responsive */
    @media (max-width:980px){.layout{grid-template-columns:1fr;}.modal-card{width:95%}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Smart Study Planner</h1>
        <div class="muted">Create study goals, track progress, set reminders & view timelines</div>
      </div>
      <div class="controls">
        <button class="btn" id="addTaskBtn">+ New Task</button>
        <button class="btn ghost" id="importBtn">Import</button>
        <button class="btn ghost" id="exportBtn">Export</button>
      </div>
    </header>

    <div class="layout">
      <aside class="sidebar card">
        <div class="section">
          <div class="label-inline">Search / Filter</div>
          <input id="search" placeholder="Search tasks, subjects..." />
        </div>
        <div class="section">
          <label class="label-inline">Date range</label>
          <div class="row">
            <div class="col"><input type="date" id="fromDate" /></div>
            <div class="col"><input type="date" id="toDate" /></div>
          </div>
        </div>
        <div class="section">
          <label class="label-inline">Priority</label>
          <select id="priorityFilter">
            <option value="all">All</option>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>

        <div class="section quick-stats">
          <div class="stat">
            <div class="muted">Tasks</div>
            <div id="statTotal">0</div>
          </div>
          <div class="stat">
            <div class="muted">Completed</div>
            <div id="statDone">0</div>
          </div>
        </div>

        <div class="section">
          <label class="label-inline">Upcoming reminder</label>
          <div id="nextReminder" class="small muted">No reminders scheduled.</div>
        </div>

        <div class="section">
          <label class="label-inline">Progress (last 7 days)</label>
          <canvas id="stats"></canvas>
        </div>

        <div class="section" style="margin-top:12px">
          <div class="muted" style="font-size:12px">Tips</div>
          <ul class="muted" style="padding-left:18px;margin-top:6px">
            <li>Break big goals into sub-tasks</li>
            <li>Use reminders 10–30 minutes before sessions</li>
            <li>Try the built-in Pomodoro for focused bursts</li>
          </ul>
        </div>

      </aside>

      <main>
        <div class="card timeline-wrap">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="muted">Drag tasks across days to reschedule • Click a task to edit</div>
            <div>
              <button id="prevWeek" class="btn ghost">◀ Prev</button>
              <button id="nextWeek" class="btn ghost">Next ▶</button>
            </div>
          </div>

          <div id="board" class="board"></div>
        </div>
        <footer>Local-only: saved in your browser (localStorage). Export/Import JSON available.</footer>
      </main>
    </div>
  </div>

  <!-- Modal for adding/editing tasks -->
  <div id="modal" class="modal">
    <div class="modal-card">
      <h3 id="modalTitle">New Task</h3>
      <div style="height:8px"></div>
      <div class="row">
        <div class="col">
          <div class="label-inline">Title</div>
          <input id="taskTitle" type="text" />
        </div>
        <div class="col">
          <div class="label-inline">Subject / Tag</div>
          <input id="taskTag" type="text" placeholder="e.g. Math, Biology" />
        </div>
      </div>

      <div style="height:8px"></div>
      <div class="row">
        <div class="col">
          <div class="label-inline">Date</div>
          <input id="taskDate" type="date" />
        </div>
        <div class="col">
          <div class="label-inline">Time</div>
          <input id="taskTime" type="time" />
        </div>
        <div class="col">
          <div class="label-inline">Priority</div>
          <select id="taskPriority"><option value="low">Low</option><option value="medium" selected>Medium</option><option value="high">High</option></select>
        </div>
      </div>

      <div style="height:8px"></div>
      <div class="section">
        <div class="label-inline">Notes / Description</div>
        <textarea id="taskNotes"></textarea>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="deleteTask" class="btn ghost" style="display:none">Delete</button>
        <button id="cancelBtn" class="btn ghost">Cancel</button>
        <button id="saveBtn" class="btn">Save Task</button>
      </div>
    </div>
  </div>

  <input id="fileInput" type="file" accept="application/json" style="display:none" />

  <script>
    /* ----------------- Data Model ----------------- */
    // Each task: {id, title, tag, date (YYYY-MM-DD), time (HH:MM), priority, notes, done:boolean, reminderMillis (optional)}

    const STORAGE_KEY = 'smart_study_planner_v1';

    // Utilities
    const $ = id => document.getElementById(id);

    function uid(prefix='t'){return prefix + Date.now().toString(36) + Math.random().toString(36).slice(2,6)}
    function todayISO(d=new Date()){ return d.toISOString().slice(0,10) }

    // Load / Save
    function loadTasks(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return [];
        return JSON.parse(raw);
      }catch(e){console.error('load err',e); return []}
    }
    function saveTasks(tasks){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

    /* ----------------- App State ----------------- */
    let tasks = loadTasks();
    if(tasks.length===0){
      // seed with sample complex dataset
      const base=new Date();
      tasks = [
        {id:uid(),title:'Calculus — Integrals practice',tag:'Math',date:todayISO(base),time:'09:00',priority:'high',notes:'Chapters 5-6: definite integrals, substitution',done:false},
        {id:uid(),title:'Biology — Plant physiology reading',tag:'Biology',date:todayISO(new Date(base.getTime()+24*3600e3)),time:'14:00',priority:'medium',notes:'Focus on transpiration section and diagrams',done:false},
        {id:uid(),title:'Chemistry — Problem set 4',tag:'Chemistry',date:todayISO(new Date(base.getTime()+2*24*3600e3)),time:'16:00',priority:'high',notes:'Practice titration calculations',done:false},
        {id:uid(),title:'History — Essay draft',tag:'History',date:todayISO(base),time:'19:00',priority:'medium',notes:'Outline + sources list',done:false},
        {id:uid(),title:'Language — Vocabulary flashcards',tag:'Spanish',date:todayISO(new Date(base.getTime()-24*3600e3)),time:'07:30',priority:'low',notes:'20 new words',done:true}
      ];
      saveTasks(tasks);
    }

    // UI refs
    const board = $('board');
    const modal = $('modal');
    const addTaskBtn = $('addTaskBtn');

    /* ----------------- Rendering ----------------- */
    function getWeekDates(center=new Date()){
      // return 7-day window centered on provided date
      const dates=[];
      const start = new Date(center.getFullYear(),center.getMonth(),center.getDate());
      start.setDate(start.getDate() - 3); // three days before
      for(let i=0;i<7;i++){ const d=new Date(start); d.setDate(start.getDate()+i); dates.push(d); }
      return dates;
    }

    let currentCenter = new Date();

    function renderBoard(){
      const dates = getWeekDates(currentCenter);
      board.innerHTML = '';
      dates.forEach(d => {
        const iso = d.toISOString().slice(0,10);
        const dayDiv = document.createElement('div'); dayDiv.className='day'; dayDiv.dataset.date=iso;
        const heading = document.createElement('h3'); heading.textContent = iso + ' — ' + d.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'});
        dayDiv.appendChild(heading);

        const dayTasks = tasks.filter(t=>t.date === iso).sort((a,b)=> (a.time||'') > (b.time||'') ? 1 : -1);
        dayTasks.forEach(t=>{
          const el = document.createElement('div'); el.className='task '+(t.priority||'medium'); el.draggable=true; el.dataset.id=t.id;
          el.innerHTML = `<div class="title">${escapeHtml(t.title)}</div><div class="meta"><div>${t.tag||''} ${t.time? ' • ' + t.time: ''}</div><div>${t.done? '✓':'○'}</div></div>`;
          el.addEventListener('click', e=>{ e.stopPropagation(); openEditTask(t.id); });
          el.addEventListener('dragstart', dragStart);
          dayDiv.appendChild(el);
        });

        dayDiv.addEventListener('dragover', e=>{ e.preventDefault(); });
        dayDiv.addEventListener('drop', e=>{ e.preventDefault(); const id=e.dataTransfer.getData('text/plain'); moveTaskToDate(id, iso); });

        board.appendChild(dayDiv);
      });

      updateStats(); renderChart(); updateNextReminder();
    }

    function escapeHtml(s=''){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function dragStart(e){ e.dataTransfer.setData('text/plain', e.target.dataset.id); }
    function moveTaskToDate(id,date){ const t = tasks.find(x=>x.id===id); if(t){ t.date = date; saveTasks(tasks); renderBoard(); } }

    /* ----------------- Modal / CRUD ----------------- */
    let editingId = null;
    function openNewTask(){ editingId=null; $('modalTitle').textContent='New Task'; $('taskTitle').value=''; $('taskTag').value=''; $('taskDate').value = todayISO(); $('taskTime').value=''; $('taskPriority').value='medium'; $('taskNotes').value=''; $('deleteTask').style.display='none'; modal.classList.add('open'); }
    function openEditTask(id){ const t = tasks.find(x=>x.id===id); if(!t) return; editingId=id; $('modalTitle').textContent='Edit Task'; $('taskTitle').value=t.title; $('taskTag').value=t.tag||''; $('taskDate').value=t.date; $('taskTime').value=t.time||''; $('taskPriority').value=t.priority||'medium'; $('taskNotes').value=t.notes||''; $('deleteTask').style.display='inline-block'; modal.classList.add('open'); }

    function closeModal(){ modal.classList.remove('open'); }

    $('cancelBtn').onclick = closeModal;
    $('addTaskBtn').onclick = openNewTask;

    $('saveBtn').onclick = ()=>{
      const title = $('taskTitle').value.trim(); if(!title){ alert('Enter a title'); return; }
      const payload = { title, tag: $('taskTag').value.trim(), date: $('taskDate').value || todayISO(), time: $('taskTime').value, priority: $('taskPriority').value, notes: $('taskNotes').value, done:false };
      if(editingId){ const idx = tasks.findIndex(x=>x.id===editingId); if(idx>=0){ tasks[idx] = {...tasks[idx], ...payload }; }
      } else { tasks.push({...payload, id: uid()}); }
      saveTasks(tasks); closeModal(); renderBoard(); scheduleUpcomingNotifications();
    };

    $('deleteTask').onclick = ()=>{
      if(!editingId) return; if(!confirm('Delete this task?')) return; tasks = tasks.filter(x=>x.id!==editingId); saveTasks(tasks); closeModal(); renderBoard(); }

    /* ----------------- Search / Filters ----------------- */
    $('search').addEventListener('input', ()=>{ applyFilters(); });
    $('fromDate').addEventListener('change', applyFilters);
    $('toDate').addEventListener('change', applyFilters);
    $('priorityFilter').addEventListener('change', applyFilters);

    function applyFilters(){
      const q = $('search').value.trim().toLowerCase();
      const from = $('fromDate').value; const to = $('toDate').value; const p = $('priorityFilter').value;
      // Filter tasks array for board view
      const filtered = tasks.filter(t=>{
        if(q){ const hay = (t.title+' '+(t.tag||'')+' '+(t.notes||'')).toLowerCase(); if(!hay.includes(q)) return false; }
        if(p!=='all' && t.priority!==p) return false;
        if(from && t.date < from) return false;
        if(to && t.date > to) return false;
        return true;
      });
      // Render a shorter board showing only days that have filtered tasks or default window
      const dates = getWeekDates(currentCenter);
      board.innerHTML='';
      dates.forEach(d=>{
        const iso = d.toISOString().slice(0,10);
        const dayDiv = document.createElement('div'); dayDiv.className='day'; dayDiv.dataset.date=iso;
        dayDiv.innerHTML = `<h3>${iso} — ${d.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'})}</h3>`;
        const dayTasks = filtered.filter(t=>t.date===iso).sort((a,b)=> (a.time||'') > (b.time||'') ? 1 : -1);
        dayTasks.forEach(t=>{ const el = document.createElement('div'); el.className='task '+(t.priority||'medium'); el.dataset.id=t.id; el.innerHTML = `<div class="title">${escapeHtml(t.title)}</div><div class="meta"><div>${t.tag||''} ${t.time? ' • ' + t.time: ''}</div><div>${t.done? '✓':'○'}</div></div>`; el.addEventListener('click', e=>{ e.stopPropagation(); openEditTask(t.id); }); dayDiv.appendChild(el); });
        dayDiv.addEventListener('dragover', e=>{ e.preventDefault(); });
        dayDiv.addEventListener('drop', e=>{ e.preventDefault(); const id=e.dataTransfer.getData('text/plain'); moveTaskToDate(id, iso); });
        board.appendChild(dayDiv);
      });
      updateStats(); renderChart(); updateNextReminder();
    }

    /* ----------------- Stats Chart ----------------- */
    const canvas = document.getElementById('stats');
    function renderChart(){
      const ctx = canvas.getContext('2d');
      const W = canvas.width = canvas.clientWidth; const H = canvas.height = canvas.clientHeight;
      ctx.clearRect(0,0,W,H);
      // last 7 days
      const arr=[]; for(let i=6;i>=0;i--){ const d=new Date(); d.setDate(d.getDate()-i); const iso=d.toISOString().slice(0,10); const total = tasks.filter(t=>t.date===iso).length; const done = tasks.filter(t=>t.date===iso && t.done).length; arr.push({iso,total,done,label:d.toLocaleDateString(undefined,{weekday:'short'})}); }
      // scale
      const max = Math.max(1, ...arr.map(a=>a.total));
      const pad=30; const stepX = (W-2*pad)/(arr.length-1);
      // draw grid
      ctx.strokeStyle='rgba(255,255,255,0.04)'; ctx.beginPath(); for(let i=0;i<4;i++){ const y = pad + (H-2*pad)*(i/3); ctx.moveTo(pad,y); ctx.lineTo(W-pad,y);} ctx.stroke();
      // line for total
      ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle='rgba(124,58,237,0.9)'; arr.forEach((a,i)=>{ const x=pad+i*stepX; const y = H - pad - (H-2*pad)*(a.total/max); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.stroke();
      // points
      arr.forEach((a,i)=>{ const x=pad+i*stepX; const y = H - pad - (H-2*pad)*(a.total/max); ctx.fillStyle='rgba(124,58,237,0.95)'; ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill(); ctx.fillStyle='rgba(255,255,255,0.6)'; ctx.font='10px sans-serif'; ctx.fillText(a.total, x-6, y-8); ctx.fillText(a.label, x-12, H-6); });
    }

    /* ----------------- Reminders + Notifications ----------------- */
    async function askNotificationPermission(){ if(!('Notification' in window)) return false; if(Notification.permission==='granted') return true; if(Notification.permission!=='denied'){ const r = await Notification.requestPermission(); return r==='granted'; } return false; }

    // schedule notifications for upcoming tasks with times (only works while page is open) 
    let scheduledTimers = [];
    function clearScheduled(){ scheduledTimers.forEach(id=>clearTimeout(id)); scheduledTimers=[]; }

    function scheduleUpcomingNotifications(){ clearScheduled();
      const now = Date.now();
      tasks.forEach(t=>{
        if(!t.time) return;
        const dt = new Date(t.date + 'T' + t.time + ':00');
        const millis = dt.getTime() - now - (10*60*1000); // default remind 10 minutes before
        if(millis>0 && millis < 7*24*3600*1000){ // schedule only near future
          const id = setTimeout(()=>{ showNotification(t); }, millis);
          scheduledTimers.push(id);
        }
      });
    }

    function showNotification(task){ if('Notification' in window && Notification.permission==='granted'){ new Notification('Study Reminder', { body: task.title + (task.time ? ' • ' + task.time : ''), tag: task.id }); } else { // fallback small in-app toast
      toast('Reminder: ' + task.title);
    }}

    function updateNextReminder(){
      const now = Date.now(); let next=null;
      tasks.forEach(t=>{ if(!t.time) return; const dt = new Date(t.date + 'T' + t.time + ':00'); const when = dt.getTime() - 10*60*1000; // 10 minutes before
        if(when>now && (!next || when<next.when)) next={task:t,when};
      });
      if(next){ const d = new Date(next.when); $('nextReminder').textContent = `${next.task.title} — ${d.toLocaleString()}`; } else $('nextReminder').textContent='No reminders scheduled.';
    }

    // tiny toast
    function toast(msg){ const el = document.createElement('div'); el.textContent=msg; el.style.position='fixed'; el.style.right='18px'; el.style.bottom='18px'; el.style.padding='10px 12px'; el.style.background='linear-gradient(90deg,#0b1220,#071829)'; el.style.border='1px solid rgba(255,255,255,0.04)'; el.style.borderRadius='8px'; document.body.appendChild(el); setTimeout(()=>el.style.opacity=0,3000); setTimeout(()=>el.remove(),3600); }

    /* ----------------- Export / Import ----------------- */
    $('exportBtn').onclick = ()=>{ const blob = new Blob([JSON.stringify(tasks,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download = 'study-planner-export-'+todayISO()+'.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); };
    $('importBtn').onclick = ()=>{ $('fileInput').click(); };
    $('fileInput').addEventListener('change', e=>{ const f=e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ev=>{ try{ const imported = JSON.parse(ev.target.result); if(Array.isArray(imported)){ tasks = imported; saveTasks(tasks); renderBoard(); toast('Imported '+tasks.length+' tasks.'); } else alert('Invalid file.'); }catch(err){alert('Import error: '+err.message);} }; reader.readAsText(f); });

    /* ----------------- Week nav */
    $('prevWeek').onclick = ()=>{ currentCenter.setDate(currentCenter.getDate()-7); renderBoard(); };
    $('nextWeek').onclick = ()=>{ currentCenter.setDate(currentCenter.getDate()+7); renderBoard(); };

    /* ----------------- Quick actions: mark done via double-click */
    board.addEventListener('dblclick', e=>{
      const taskEl = e.target.closest('.task'); if(!taskEl) return; const id = taskEl.dataset.id; const t = tasks.find(x=>x.id===id); if(!t) return; t.done = !t.done; saveTasks(tasks); renderBoard(); });

    /* ----------------- Initialization ----------------- */
    (async function init(){
      renderBoard(); renderChart();
      await askNotificationPermission(); scheduleUpcomingNotifications();
    })();

    // keep scheduled timers updated when page gains focus
    window.addEventListener('focus', ()=>{ scheduleUpcomingNotifications(); updateNextReminder(); });

    // small utility to update stats numbers
    function updateStats(){ $('statTotal').textContent = tasks.length; $('statDone').textContent = tasks.filter(t=>t.done).length; }

    // simple escape for template
    // clicking outside modal closes it
    modal.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });

    // expose a simple import/export via console for power users
    window.__STUDY = {tasks, save: ()=>saveTasks(tasks)};

  </script>
</body>
</html>
